# Maintainer: Samir Benmendil <samir.benmendil[at]gmail[dot]com>
# Contributer: N30N <archlinux@alunamation.com>
# Contributor: swiftgeek <swiftgeek@gmail.com>
# Contributor: Marvn <mistrmarvn@gmail.com>

pkgname="shank"
pkgver="120720110_1"
_pkgver="120720110-1"
pkgrel=1
pkgdesc="[Humble Bundle 4] A 2D side-scrolling beat 'em up."
url="http://www.shankgame.com/"
license=("custom")
arch=("i686" "x86_64")
if [ "${CARCH}" == "x86_64" ]; then
	depends=("lib32-sdl" "lib32-libgl")
else
	depends=("sdl" "libgl")
fi
makedepends=("unzip")
source=("shank.sh" "shank.desktop")
md5sums=("dd6523a1d46bab31a07178da66357e9d" \
	       "159eddeeba8a32d5c8932c8d802ad1af")
PKGEXT=".pkg.tar"

_archive="shank-linux-${_pkgver}"
_archive_md5="f42fb76ad67316c3d7fa5378ad9c5f57"

build() {
  cd ${srcdir}

  if [ ! -f ${_shankarchivelocation}${_archive} ]; then
    if [ ! -f ${_archive} ] && [ -n "${_humblebundle4key}" ]; then
    rm -f ${_archive}* index.html?key\=${_humblebundle4key}*
    wget http://www.humblebundle.com/?key=${_humblebundle4key}
    wget $(cat index.html?key\=${_humblebundle4key} | grep "${_archive}" | cut -d "'" -f 10)
    mv ${_archive}* ${_archive}
    elif [ -z "${_humblebundle4key}" ]; then
    echo You can automate the download of the archive using the _humblebundle4key bash variable.
    echo Just add 'export _humblebundle4key\=\<Your key here\>' to \.bashrc
    echo
    echo Otherwise please just place ${_archive} into $(pwd)/
    echo Press Enter to continue
    read -a _unused
    fi
  fi
#' 

  if [ ! -f ${_shankarchivelocation}${_archive} ]; then
    echo "${_shankarchivelocation}${_archive} not found!"
    return 1
  fi

  if ! echo "${_archive_md5}  ${_shankarchivelocation}${_archive}" | md5sum -c --quiet; then
    echo "Invalid checksum for ${_shankarchivelocation}${_archive}"
    return 1
  fi  

	unzip -n "${_archive}" || true
}

package() {
	install -Dm755 shank.sh "${pkgdir}/usr/bin/shank"
	install -Dm644 shank.desktop "${pkgdir}/usr/share/applications/shank.desktop"

	cd data
	install -Dm644 bin/.DS_Store "${pkgdir}/opt/shank/bin/.DS_Store"
	install -m755 bin/{libfmodevent-4.30.02.so,libfmodex-4.30.02.so,Shank} \
		"${pkgdir}/opt/shank/bin"
	find {data,data-pc,reslists} -type f \
		-exec install -Dm644 "{}" "${pkgdir}/opt/shank/{}" \;
}

# vim:set ts=2 sw=2 et:
